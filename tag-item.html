<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<!--
tag-item is a tag element used by tags-input to show tags with a closed button.
    <tag-item></tag-item>
@demo
-->
<dom-module id="tag-item">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }
    .tag-value{
      display: inline-block;
      vertical-align: middle;
    }
    .tag-item-container{
      position: relative;
      background-color: var(--light-primary-color);
      float: left;
      margin-left: 6px;
      margin-bottom: 3px;
      display: inline-block;
    }
    .large.tag-item-container{
      border-radius: 20px;
      padding-left:14px;
    }
    .medium.tag-item-container{
      border-radius: 17px;
      padding-left: 11px;
    }
    .small.tag-item-container{
      border-radius: 14px;
      padding-left: 9px;
    }
    .large{
      font-size:18px;
    }
    .large paper-icon-button{
        height: 40px;
        width: 40px;
    }
    .large paper-icon-button::shadow #icon{
        width: 22px;
        height: 22px;
    }
    .medium paper-icon-button{
        height: 34px;
        width: 34px;
    }
    .medium{
      font-size:14px;
    }
    .medium paper-icon-button::shadow #icon{
        width: 18px;
        height: 18px;
    }
    .small paper-icon-button{
        height: 30px;
        width: 30px;
    }
    .small{
      font-size:12px;
    }
    .small paper-icon-button::shadow #icon{
        width: 14px;
        height: 14px;
    }
    .tag-item-container .tooltiptext {
        float: left;
        max-width: 500px;
        margin-top: 2px;
        line-height: 1.5;
        font-size: 12px;
        font-family: Roboto;
        font-weight: 300;
        font-stretch: ultra-expanded;
        background-color: #232F34;
        color: #fff;
        text-align: left;
        border-radius: 4px;
        padding: 10px;
        position: absolute;
        z-index: 1;
    }
    .fade-in {
      -webkit-animation: fadeIn 0.5s ease-in 1 forwards;
      animation: fadeIn 0.5s ease-in 1 forwards;
      opacity: 0;
    }
    .is-paused {
      -webkit-animation-play-state: paused;
      animation-play-state: paused;
    }
    @-webkit-keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
    .suggestion {
      padding-left:0 !important;
      color: #bdbdbd !important;
    }
    .cancel {
      color: #bdbdbd;
    }
    
    .accept {
      color: #5c6bc0;
    }
  </style>
  <template>
    <div id="tag" style$="{{_containerColor(tagColor, fontColor)}}" class$="{{_containerClass(size)}} {{_isSuggestion(isSuggestion)}}" data-args$={{tagData.refId}} on-mousemove="_onMouseMove" on-mouseout="_onMouseOut">
      <template is="dom-if" if="{{isSuggestion}}">
        <paper-icon-button class="cancel" icon="icons:cancel" on-tap="_removeSuggestion"></paper-icon-button>
        <span class="tag-value">{{suggestionValue}}</span>
        <paper-icon-button class="accept" icon="icons:check-circle" on-tap="_addSuggestion"></paper-icon-button>
      </template>
      <template is="dom-if" if="{{!isSuggestion}}">
        <span data-args$={{tagData.refId}} class="tag-value">{{tagData.label}}</span>
        <template is="dom-if" if="{{enableRemove}}">
          <paper-icon-button data-args$={{tagData.refId}} on-tap="_removeItem" icon="icons:cancel"></paper-icon-button>
        </template>
        <template is="dom-if" if="{{!enableRemove}}">
          <paper-icon-button data-args$={{tagData.refId}} style="width:0px;visibility:hidden;" on-tap="remove" icon="icons:cancel"></paper-icon-button>
        </template>
        <span id="tooltip" hidden$="[[!enableTooltip]]" class="tooltiptext fade-in is-paused">{{synonymsString}}</span>
      </template>
    </div>
  </template>

</dom-module>

<script>
  Polymer({
    is: 'tag-item',
    properties: {
      /**
      * Fired when the tag is to be removed from the tag list
      *
      * @event tag-item-remove
      */
      /**
      * index of the tag
      */
       index: Number,
      /**
      * size of the tags, possible values: small, medium, large
      */
       size:{
        type: String,
        value: 'large'
       },
       isSuggestion: {
        type: Boolean,
        value: false
       },
       /**
       * CSS color of tag
       */
       tagColor: String,
       /**
       * CSS color of text and remove button
       */
       fontColor: String,
       /**
       * Boolean flag to indicate if enable remove operation
       */
       enableRemove:{
        type: Boolean,
        value: true
      },
      /**
      * value of the tag
      */
      tagData: {
        type: Array,
        notify: true,
        value: function () { return []; },
      },
      /**
      * type of tag
      */
      tagType: {
        type: String,
        notify: true,
      },
      /**
      * value to indicate whether to display tooltip or not.
      */
      enableTooltip: {
        type: Boolean,
      },
      /**
      * comma seperated string consisting synonyms.
      */
      synonymsString: {
        type: String,
        notify: true,
      },
      /**
      * value to indicate whether tag is hovered or not.
      */
      isHovered: {
        type: String,
        notify: true,
        value: false
      },
      /**
      * value of the suggestion
      */
      suggestionValue:String
    },
    observers: [
        "_docsUpdated(tagData.doc.*)"
    ],
    ready:function() {
    },
    /**
     * _containerColor is the internal method to compute background style
     *
     */
     _containerColor:function(tagColor, fontColor){
      var styles = []
      if (typeof(tagColor) != "undefined"){
        styles.push("background-color:" + tagColor);
      }
      if (typeof(fontColor) != "undefined"){
        styles.push("color:" + fontColor);
      }
      return styles.join(";");
     },
    /**
     * _containerClass is the internal method to compute size css name
     *
     */
     _containerClass:function(size){
       return size + " tag-item-container";
     },
     _isSuggestion: function(suggestion) {
       return suggestion && "suggestion"
     },
     
    /**
     * Handler for removing the tag item
     */
     _removeItem: function() {
      if (this.enableRemove === true) {
        this.fire('tag-item-remove', {index: this.index});
      }
    },
    /**
     * Function to set tooltip size.
    */
    _setTooltipSize: function(length) {
      length > 80 ?
        this.$$("#tooltip").style.width = "500px" :
        this.$$("#tooltip").style.whiteSpace = "nowrap";
    },
    /**
     * Handler for MouseOut on Tags.
     */
     _onMouseOut: function(e) {
      if(this.tagType == "group") {
        this.isHovered = false;
        this.$$("#tooltip").classList.add("is-paused");
        this.$$("#tooltip").style.display = "none";
      }
    },
    /**
     * Handler for MouseMove on Tags.
     */
    _onMouseMove: function(e) {
      if(this.tagType == "group") {
        this.isHovered = true;
        if(!this.synonymsExists(this.tagData.refId)) {
          this.enableTooltip = false;
          this.$$("#tag").style.cursor = "wait";
          this.$$("#tooltip").classList.add("is-paused");
          this.fire("get-synonyms-intent", this.tagData.refId);
        } else {
          this.$$("#tag").style.cursor = "default";
          this.synonymsString = this.tagData.doc.toString().replace(/,/g, ", ");
          this._setTooltipSize(this.synonymsString.length);
          this.enableTooltip = true;
          this.$$("#tooltip").style.display = "block";
          this.$$("#tooltip").classList.remove("is-paused");
        }
      } else {
        this.enableTooltip = false;
      }
    },
    /**
     * Function to check whether synonyms exist for particular tag.
     */
    synonymsExists: function(refId) {
      if(this.tagData.refId == refId && this.tagData.doc.length > 0) {
        return true
      }
      return false
    },
    /**
     * Function to observe whether the docs(synonyms) are updated.
     */
    _docsUpdated: function() {
      if(this.tagData.doc != undefined && this.tagData.doc.length > 0 && this.isHovered) {
          this.$$("#tag").style.cursor = "default";
          this.synonymsString = this.tagData.doc.toString().replace(/,/g, ", ");
          this._setTooltipSize(this.synonymsString.length);
          this.enableTooltip = true;
          this.$$("#tooltip").style.display = "block";
          this.$$("#tooltip").classList.remove("is-paused");
      }
    },
    /**
     * Function to fire suggestionn item added event.
     */
    _addSuggestion: function() {
         this.fire("suggestedTag-item-added", {index: this.index});
    },
    /**
     * Function to fire suggestionn item removed event.
     */
    _removeSuggestion: function() {
        this.fire("suggestedTag-item-removed", {index: this.index});
    }  
  });
</script>